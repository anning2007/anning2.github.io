<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>传令员</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 自定义字体声明 */
        @font-face {
            font-family: 'FashionBitmap';
            src: url('ziti/FashionBitmap16_0.092.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
            background-color: #000000;
            font-family: 'FashionBitmap', 'Segoe UI', 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        /* 容器渐变出现效果 */
        .container {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 2s ease forwards;
            max-width: 900px;
            width: 90%;
            text-align: center;
            position: relative;
            z-index: 2;
            padding: 20px;
            background: transparent;
            border: none;
        }

        /* 图片样式 - 无发光效果 */
        .header-image {
            width: 180px;
            height: 180px;
            margin: 0 auto 40px;
            border-radius: 50%;
            overflow: hidden;
            border: none;
            position: relative;
            animation: float-image 6s ease-in-out infinite;
            background: transparent;
        }

        .header-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 指令标题样式 - 纯蓝光文字 */
        .instruction-title {
            color: #ffffff;
            font-family: 'FashionBitmap', monospace;
            font-size: 3.5rem;
            margin-bottom: 30px;
            letter-spacing: 3px;
            text-shadow: 
                0 0 10px rgba(0, 100, 255, 0.9),
                0 0 20px rgba(0, 100, 255, 0.7),
                0 0 30px rgba(0, 100, 255, 0.5);
            position: relative;
            padding-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
        }

        .instruction-title:hover {
            text-shadow: 
                0 0 15px rgba(0, 150, 255, 1),
                0 0 30px rgba(0, 150, 255, 0.9),
                0 0 45px rgba(0, 150, 255, 0.7);
            transform: translateY(-2px);
        }

        .instruction-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(0, 150, 255, 0.8), 
                transparent);
            box-shadow: 0 0 10px rgba(0, 150, 255, 0.5);
        }

        /* 指令内容样式 - 纯蓝光文字 */
        .instruction-text {
            color: #ffffff;
            font-family: 'FashionBitmap', monospace;
            font-size: 2.8rem;
            line-height: 1.7;
            min-height: 250px;
            margin: 40px 0;
            padding: 0;
            background: transparent;
            border: none;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 
                0 0 8px rgba(0, 100, 255, 0.9),
                0 0 16px rgba(0, 100, 255, 0.7),
                0 0 24px rgba(0, 100, 255, 0.5);
        }

        .instruction-text:hover {
            text-shadow: 
                0 0 12px rgba(0, 150, 255, 1),
                0 0 24px rgba(0, 150, 255, 0.9),
                0 0 36px rgba(0, 150, 255, 0.7);
            transform: translateY(-3px);
        }

        .char {
            display: inline-block;
            opacity: 0;
            transform: translateY(20px);
            animation: popIn 0.3s forwards;
            text-shadow: 
                0 0 8px rgba(0, 100, 255, 0.9),
                0 0 16px rgba(0, 100, 255, 0.7);
            font-family: inherit;
        }

        /* 页脚 - 纯蓝光文字 */
        .footer {
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'FashionBitmap', monospace;
            font-size: 1.5rem;
            letter-spacing: 3px;
            position: relative;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 
                0 0 5px rgba(0, 100, 255, 0.8),
                0 0 10px rgba(0, 100, 255, 0.6);
            border: none;
            background: transparent;
        }

        .footer:hover {
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 
                0 0 8px rgba(0, 150, 255, 0.9),
                0 0 16px rgba(0, 150, 255, 0.7),
                0 0 24px rgba(0, 150, 255, 0.5);
        }

        /* 点击提示动画 */
        .click-hint {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(0, 200, 255, 0.9);
            font-size: 1.8rem;
            opacity: 0;
            animation: fadeInOut 3s infinite;
            pointer-events: none;
            white-space: nowrap;
            text-shadow: 
                0 0 5px rgba(0, 200, 255, 0.8),
                0 0 10px rgba(0, 200, 255, 0.6);
        }

        /* 限制提示样式 */
        .limit-hint {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 100, 100, 0.9);
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(255, 100, 100, 0.7);
            white-space: nowrap;
            pointer-events: none;
        }

        /* 打字机光标 */
        .cursor {
            display: inline-block;
            width: 3px;
            height: 1.2em;
            background-color: rgba(0, 200, 255, 0.9);
            margin-left: 2px;
            vertical-align: middle;
            box-shadow: 0 0 10px rgba(0, 200, 255, 0.8);
            animation: blink 1s infinite;
        }

        /* 音频状态指示器 */
        .audio-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8rem;
            z-index: 100;
            font-family: monospace;
        }

        /* 动画定义 */
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes popIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes float-image {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-15px);
            }
        }

        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0;
                transform: translateX(-50%) translateY(0);
            }
            50% {
                opacity: 1;
                transform: translateX(-50%) translateY(-5px);
            }
        }

        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }

        @keyframes click-pulse {
            0% {
                text-shadow: 
                    0 0 8px rgba(0, 100, 255, 0.9),
                    0 0 16px rgba(0, 100, 255, 0.7),
                    0 0 24px rgba(0, 100, 255, 0.5);
            }
            50% {
                text-shadow: 
                    0 0 15px rgba(0, 200, 255, 1),
                    0 0 30px rgba(0, 200, 255, 0.9),
                    0 0 45px rgba(0, 200, 255, 0.7);
            }
            100% {
                text-shadow: 
                    0 0 8px rgba(0, 100, 255, 0.9),
                    0 0 16px rgba(0, 100, 255, 0.7),
                    0 0 24px rgba(0, 100, 255, 0.5);
            }
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 15px;
            }

            .instruction-title {
                font-size: 2.8rem;
                margin-bottom: 20px;
            }

            .instruction-text {
                font-size: 2.2rem;
                min-height: 200px;
                margin: 30px 0;
            }

            .header-image {
                width: 150px;
                height: 150px;
                margin-bottom: 30px;
            }

            .footer {
                font-size: 1.2rem;
                margin-top: 30px;
            }

            .click-hint {
                font-size: 1.4rem;
                bottom: -30px;
            }

            .limit-hint {
                font-size: 1.2rem;
                bottom: -45px;
            }
        }

        @media (max-width: 480px) {
            .instruction-title {
                font-size: 2.2rem;
            }

            .instruction-text {
                font-size: 1.8rem;
                min-height: 180px;
            }

            .click-hint {
                font-size: 1.2rem;
                bottom: -25px;
            }

            .footer {
                font-size: 1rem;
            }

            .header-image {
                width: 120px;
                height: 120px;
            }

            .limit-hint {
                font-size: 1rem;
                bottom: -35px;
            }
        }
    </style>
</head>
<body>
    <!-- 音频状态指示器 -->
    <div class="audio-status" id="audioStatus">音频: 准备中</div>

    <div class="container">
        <!-- 图片区域 -->
        <div class="header-image">
            <!-- 使用指定图片路径 -->
            <img src="img/index_new.png" alt="随机指令图标">
        </div>

        <!-- 指令显示区域 -->
        <div class="instruction-text" id="instructionText">
            点击文字生成随机指令
        </div>

        <!-- 页脚 -->
        <div class="footer" id="footerText">
            传令员 - 每日指令
        </div>
    </div>

    <script>
        // 随机指令库
        const instructions = [
            "一天睡100个小时，醒来后连续吃50个冰淇淋",
            "倒立行走去上班，全程不能双脚着地",
            "用脚趾弹奏钢琴并录制一首完整的歌曲",
            "在超市里用唱的方式完成购物清单",
            "连续观看同一部电影10遍，每次用不同的口音配音",
            "用香蕉作为唯一工具组装一台电脑",
            "在公园里寻找一片形状像恐龙的树叶",
            "把自己打扮成外星人，去图书馆借一本关于宇宙的书",
            "用左手（或非惯用手）写一封3000字的情书",
            "在客厅搭建一个帐篷，并在里面度过整个周末",
            "用反向语言（倒着说话）与朋友通话10分钟",
            "一天内学会用三种不同语言说'你好'和'谢谢'",
            "用食物制作一幅世界地图并吃掉它",
            "尝试用鼻子操作手机发送一条完整的短信",
            "给家里的每件物品都起一个名字并制作标签",
            "在黑暗中生活24小时（包括使用手机和电脑）",
            "用舞蹈动作解释一个科学概念并录制成视频",
            "制作一个完全由糖果组成的晚餐菜单",
            "在社交媒体上连续发布100条押韵的状态更新",
            "用纸箱制作一套中世纪盔甲并穿着它去取快递",
            "用冰块雕刻一个自己的雕像并观察它融化",
            "把自己的一天倒过来过，从晚餐开始以早餐结束",
            "用不同颜色的袜子搭配出彩虹色系并穿一周",
            "学会用摩斯密码与朋友进行日常对话",
            "在厨房里找到5种可以当作乐器的物品并开一场音乐会",
            "用粉笔在人行道上画一幅完整的连环漫画",
            "学习像鸟一样鸣叫并尝试与鸟类交流",
            "用废旧材料制作一台时间机器模型",
            "创作一首关于日常用品的史诗并背诵它",
            "把自己想象成侦探，调查家中一件物品的'来历'",
            "用棉花糖搭建一座迷你城市并吃掉它",
            "学会倒着走路并且一整天都这样移动",
            "用不同水果的果皮制作一件可穿戴的艺术品",
            "给家里的宠物举办一场正式的婚礼仪式",
            "用影子表演一出完整的皮影戏",
            "尝试用脚完成所有日常任务一整天",
            "用树叶和花朵制作自己的香水",
            "在浴室里开一场个人演唱会并录制下来",
            "用蔬菜雕刻出十二生肖的所有动物",
            "学会用手语唱一首流行歌曲"
        ];

        // 获取DOM元素
        const instructionText = document.getElementById('instructionText');
        const instructionTitle = document.getElementById('instructionTitle');
        const footerText = document.getElementById('footerText');
        const audioStatus = document.getElementById('audioStatus');

        // 存储键名
        const STORAGE_KEYS = {
            LAST_CLICK_DATE: 'herald_last_click_date',
            LAST_INSTRUCTION: 'herald_last_instruction'
        };

        // 音频对象
        let welcomeAudio = null;
        let typingAudio = null;
        let isTypingAudioPlaying = false;

        // 初始化音频
        function initAudio() {
            try {
                // 创建欢迎音频（页面加载时播放一次）
                welcomeAudio = new Audio('yin/1.wav');
                welcomeAudio.preload = 'auto';

                // 创建打字音频（文字出现时播放3秒）
                typingAudio = new Audio('yin/2.wav');
                typingAudio.preload = 'auto';

                audioStatus.textContent = '音频: 已加载';

                // 页面加载完成后播放欢迎音频
                setTimeout(() => {
                    playWelcomeAudio();
                }, 500);

            } catch (error) {
                console.error('音频初始化失败:', error);
                audioStatus.textContent = '音频: 加载失败';
            }
        }

        // 播放欢迎音频
        function playWelcomeAudio() {
            if (welcomeAudio) {
                welcomeAudio.play().then(() => {
                    audioStatus.textContent = '';
                    setTimeout(() => {
                        audioStatus.textContent = '';
                    }, 1000);
                }).catch(error => {
                    console.error('', error);
                    audioStatus.textContent = '';
                });
            }
        }

        // 播放打字音频（3秒）
        function playTypingAudio() {
            if (typingAudio && !isTypingAudioPlaying) {
                isTypingAudioPlaying = true;

                // 重置音频到开始位置
                typingAudio.currentTime = 0;

                // 播放音频
                typingAudio.play().then(() => {
                    audioStatus.textContent = '音频: 打字音效';

                    // 3秒后停止播放
                    setTimeout(() => {
                        typingAudio.pause();
                        typingAudio.currentTime = 0;
                        isTypingAudioPlaying = false;
                        audioStatus.textContent = '音频: 就绪';
                    }, 3000);

                }).catch(error => {
                    console.error('播放打字音频失败:', error);
                    isTypingAudioPlaying = false;
                    audioStatus.textContent = '音频: 播放失败';
                });
            }
        }

        // 获取今天日期字符串（YYYY-MM-DD格式）
        function getTodayDateString() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        // 检查是否可以点击（每天只能点击一次）
        function canClickToday() {
            const lastClickDate = localStorage.getItem(STORAGE_KEYS.LAST_CLICK_DATE);
            const today = getTodayDateString();
            
            // 如果上次点击日期不是今天，则可以点击
            return lastClickDate !== today;
        }

        // 记录今天的点击
        function recordTodayClick(instruction) {
            const today = getTodayDateString();
            localStorage.setItem(STORAGE_KEYS.LAST_CLICK_DATE, today);
            localStorage.setItem(STORAGE_KEYS.LAST_INSTRUCTION, instruction);
        }

        // 检查并恢复今天的指令（如果有）
        function checkAndRestoreTodayInstruction() {
            const lastClickDate = localStorage.getItem(STORAGE_KEYS.LAST_CLICK_DATE);
            const lastInstruction = localStorage.getItem(STORAGE_KEYS.LAST_INSTRUCTION);
            const today = getTodayDateString();

            // 如果上次点击是今天，则显示上次的指令
            if (lastClickDate === today && lastInstruction) {
                return lastInstruction;
            }
            
            return null;
        }

        // 显示限制提示
        function showLimitHint() {
            // 移除可能存在的旧提示
            const oldHint = instructionText.querySelector('.limit-hint');
            if (oldHint) {
                oldHint.remove();
            }

            // 添加新的限制提示
            const limitHint = document.createElement('div');
            limitHint.classList.add('limit-hint');
            limitHint.textContent = '今日指令已生成，请明天再来';
            instructionText.appendChild(limitHint);
        }

        // 预加载自定义字体
        function preloadFont() {
            const font = new FontFace('FashionBitmap', 'url(ziti/FashionBitmap16_0.092.ttf)');

            font.load().then(function(loadedFont) {
                document.fonts.add(loadedFont);
                console.log('字体加载成功');
                // 字体加载完成后，显示初始文字
                showInitialText();
            }).catch(function(error) {
                console.log('字体加载失败:', error);
                // 如果字体加载失败，使用备用字体
                document.body.style.fontFamily = "'Courier New', monospace";
                document.querySelectorAll('.instruction-title, .instruction-text, .footer').forEach(el => {
                    el.style.fontFamily = "'Courier New', monospace";
                });
                showInitialText();
            });
        }

        // 显示初始文字
        function showInitialText() {
            // 检查是否有今天已经生成的指令
            const todayInstruction = checkAndRestoreTodayInstruction();
            
            if (todayInstruction) {
                // 显示今天的指令
                typeWriter(todayInstruction, instructionText, 60, false);
                // 添加限制提示
                showLimitHint();
            } else {
                // 显示默认提示
                typeWriter("点击文字生成今日指令", instructionText, 60, false);
            }
        }

        // 文字逐个显示函数
        function typeWriter(text, element, speed = 50, playSound = true) {
            // 清空现有内容
            element.innerHTML = '';

            // 如果需要播放声音，开始播放打字音频
            if (playSound) {
                playTypingAudio();
            }

            // 创建字符数组
            const chars = text.split('');
            let charIndex = 0;

            // 打字机效果函数
            function typeNextChar() {
                if (charIndex < chars.length) {
                    const span = document.createElement('span');
                    span.classList.add('char');
                    span.textContent = chars[charIndex] === ' ' ? '\u00A0' : chars[charIndex];
                    element.appendChild(span);

                    // 设置动画延迟
                    span.style.animationDelay = `${charIndex * speed}ms`;

                    charIndex++;
                    setTimeout(typeNextChar, speed);
                } else {
                    // 检查是否需要添加限制提示
                    if (!canClickToday()) {
                        showLimitHint();
                    } else {
                        // 添加点击提示
                        const clickHint = document.createElement('div');
                        clickHint.classList.add('click-hint');
                        clickHint.textContent = '点击生成今日指令';
                        element.appendChild(clickHint);
                    }
                }
            }

            // 开始打字效果
            typeNextChar();
        }

        // 生成随机指令
        function generateRandomInstruction() {
            // 检查是否可以点击
            if (!canClickToday()) {
                // 显示提示动画
                instructionText.style.animation = 'click-pulse 0.8s ease';
                setTimeout(() => {
                    instructionText.style.animation = '';
                }, 800);
                return;
            }

            // 随机选择一条指令
            const randomIndex = Math.floor(Math.random() * instructions.length);
            const randomInstruction = instructions[randomIndex];

            // 记录今天的点击
            recordTodayClick(randomInstruction);

            // 使用打字机效果显示指令（播放打字音频）
            typeWriter(randomInstruction, instructionText, 40, true);

            // 添加点击脉冲效果
            instructionText.style.animation = 'click-pulse 0.8s ease';
            setTimeout(() => {
                instructionText.style.animation = '';
            }, 800);
        }

        // 添加点击事件监听器
        function addClickListeners() {
            // 只有文字区域可以点击生成指令
            instructionText.addEventListener('click', generateRandomInstruction);
            footerText.addEventListener('click', generateRandomInstruction);
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化音频
            initAudio();

            // 预加载字体
            preloadFont();

            // 添加点击事件监听器
            addClickListeners();

            // 添加键盘支持
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space' || event.code === 'Enter') {
                    generateRandomInstruction();
                }
            });
        });
    </script>
</body>
</html>