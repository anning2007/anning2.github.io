<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>传令员</title>
    <style>
        /* [所有CSS样式保持不变] */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @font-face {
            font-family: 'FashionBitmap';
            src: url('ziti/FashionBitmap16_0.092.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        body {
            background-color: #000000;
            font-family: 'FashionBitmap', 'Segoe UI', 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .container {
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 2s ease forwards;
            max-width: 900px;
            width: 90%;
            text-align: center;
            position: relative;
            z-index: 2;
            padding: 20px;
            background: transparent;
            border: none;
        }

        .header-image {
            width: 180px;
            height: 180px;
            margin: 0 auto 40px;
            border-radius: 50%;
            overflow: hidden;
            border: none;
            position: relative;
            animation: float-image 6s ease-in-out infinite;
            background: transparent;
        }

        .header-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .instruction-title {
            color: #ffffff;
            font-family: 'FashionBitmap', monospace;
            font-size: 3.5rem;
            margin-bottom: 30px;
            letter-spacing: 3px;
            text-shadow: 
                0 0 10px rgba(0, 100, 255, 0.9),
                0 0 20px rgba(0, 100, 255, 0.7),
                0 0 30px rgba(0, 100, 255, 0.5);
            position: relative;
            padding-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
        }

        .instruction-title:hover {
            text-shadow: 
                0 0 15px rgba(0, 150, 255, 1),
                0 0 30px rgba(0, 150, 255, 0.9),
                0 0 45px rgba(0, 150, 255, 0.7);
            transform: translateY(-2px);
        }

        .instruction-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(0, 150, 255, 0.8), 
                transparent);
            box-shadow: 0 0 10px rgba(0, 150, 255, 0.5);
        }

        .instruction-text {
            color: #ffffff;
            font-family: 'FashionBitmap', monospace;
            font-size: 2.8rem;
            line-height: 1.7;
            min-height: 250px;
            margin: 40px 0;
            padding: 0;
            background: transparent;
            border: none;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 
                0 0 8px rgba(0, 100, 255, 0.9),
                0 0 16px rgba(0, 100, 255, 0.7),
                0 0 24px rgba(0, 100, 255, 0.5);
        }

        .instruction-text:hover {
            text-shadow: 
                0 0 12px rgba(0, 150, 255, 1),
                0 0 24px rgba(0, 150, 255, 0.9),
                0 0 36px rgba(0, 150, 255, 0.7);
            transform: translateY(-3px);
        }

        .char {
            display: inline-block;
            opacity: 0;
            transform: translateY(20px);
            animation: popIn 0.3s forwards;
            text-shadow: 
                0 0 8px rgba(0, 100, 255, 0.9),
                0 0 16px rgba(0, 100, 255, 0.7);
            font-family: inherit;
        }

        .footer {
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'FashionBitmap', monospace;
            font-size: 1.5rem;
            letter-spacing: 3px;
            position: relative;
            z-index: 2;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 
                0 0 5px rgba(0, 100, 255, 0.8),
                0 0 10px rgba(0, 100, 255, 0.6);
            border: none;
            background: transparent;
        }

        .footer:hover {
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 
                0 0 8px rgba(0, 150, 255, 0.9),
                0 0 16px rgba(0, 150, 255, 0.7),
                0 0 24px rgba(0, 150, 255, 0.5);
        }

        .click-hint {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(0, 200, 255, 0.9);
            font-size: 1.8rem;
            opacity: 0;
            animation: fadeInOut 3s infinite;
            pointer-events: none;
            white-space: nowrap;
            text-shadow: 
                0 0 5px rgba(0, 200, 255, 0.8),
                0 0 10px rgba(0, 200, 255, 0.6);
        }

        .limit-hint {
            position: absolute;
            bottom: -60px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 100, 100, 0.9);
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(255, 100, 100, 0.7);
            white-space: nowrap;
            pointer-events: none;
        }

        .cursor {
            display: inline-block;
            width: 3px;
            height: 1.2em;
            background-color: rgba(0, 200, 255, 0.9);
            margin-left: 2px;
            vertical-align: middle;
            box-shadow: 0 0 10px rgba(0, 200, 255, 0.8);
            animation: blink 1s infinite;
        }

        .audio-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8rem;
            z-index: 100;
            font-family: monospace;
        }

        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes popIn {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float-image {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateX(-50%) translateY(0); }
            50% { opacity: 1; transform: translateX(-50%) translateY(-5px); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        @keyframes click-pulse {
            0% {
                text-shadow: 
                    0 0 8px rgba(0, 100, 255, 0.9),
                    0 0 16px rgba(0, 100, 255, 0.7),
                    0 0 24px rgba(0, 100, 255, 0.5);
            }
            50% {
                text-shadow: 
                    0 0 15px rgba(0, 200, 255, 1),
                    0 0 30px rgba(0, 200, 255, 0.9),
                    0 0 45px rgba(0, 200, 255, 0.7);
            }
            100% {
                text-shadow: 
                    0 0 8px rgba(0, 100, 255, 0.9),
                    0 0 16px rgba(0, 100, 255, 0.7),
                    0 0 24px rgba(0, 100, 255, 0.5);
            }
        }

        @media (max-width: 768px) {
            .container { width: 95%; padding: 15px; }
            .instruction-title { font-size: 2.8rem; margin-bottom: 20px; }
            .instruction-text { font-size: 2.2rem; min-height: 200px; margin: 30px 0; }
            .header-image { width: 150px; height: 150px; margin-bottom: 30px; }
            .footer { font-size: 1.2rem; margin-top: 30px; }
            .click-hint { font-size: 1.4rem; bottom: -30px; }
            .limit-hint { font-size: 1.2rem; bottom: -45px; }
        }

        @media (max-width: 480px) {
            .instruction-title { font-size: 2.2rem; }
            .instruction-text { font-size: 1.8rem; min-height: 180px; }
            .click-hint { font-size: 1.2rem; bottom: -25px; }
            .footer { font-size: 1rem; }
            .header-image { width: 120px; height: 120px; }
            .limit-hint { font-size: 1rem; bottom: -35px; }
        }
    </style>
</head>
<body>
    <div class="audio-status" id="audioStatus">音频: 准备中</div>

    <div class="container">
        <div class="header-image">
            <img src="img/index_new.png" alt="随机指令图标">
        </div>

        <div class="instruction-text" id="instructionText">
            点击文字生成随机指令
        </div>

       
    </div>

    <script>
        const instructions = [
            "一天内刷50遍镜牢",
            "倒立行走去上班，全程不能双脚着地",
            "明日正午之前在厉利的生日蛋糕中放入3根针。",
            "致，打开B站聆听150次mill的任意一首歌",
            "与您遇见的第3个人猜拳且出拳头，若您获胜则拔掉对方59根头发，拌以只吃泡沫塑料长大的黄粉虫，海鲜奶油意粉酱涂抹3次后用叉子将其吃掉。",
            "杀掉你画的画。",
            "明日3时38分在某十字路口望向东方并挥7次手。",
            "把自己打扮成外星人，去图书馆借一本关于宇宙的书",
            "遇到在三岔路口处挥手7次的人时便直接跟着他直至他的家中",
            "只用右手进食、书写或扣下扳机",
            "将热水烧到500度之后喝掉",
            "请每日睡足八百小时",
            "喝下一升牛奶，运动前请热身",
            "请在吃饭，写字，或扣下扳机时使用右手",
            "30分钟内找到一名伴侣，棕色头发为佳",
            "请在400,000米后右转",
            "用舞蹈动作解释一个科学概念并录制成视频",
            "制作一个完全由糖果组成的晚餐菜单",
            "在社交媒体上连续发布100条押韵的状态更新",
            "用纸箱制作一套中世纪盔甲并穿着它去取快递",
            "用冰块雕刻一个自己的雕像并观察它融化",
            "把自己的一天倒过来过，从晚餐开始以早餐结束",
            "用不同颜色的袜子搭配出彩虹色系并穿一周",
            "学会用摩斯密码与朋友进行日常对话",
            "在厨房里找到5种可以当作乐器的物品并开一场音乐会",
            "用粉笔在人行道上画一幅完整的连环漫画",
            "学习像鸟一样鸣叫并尝试与鸟类交流",
            "用废旧材料制作一台时间机器模型",
            "创作一首关于日常用品的史诗并背诵它",
            "请重复聆听9570404次SAIKAI",
            "用棉花糖搭建一座迷你城市并吃掉它",
            "学会倒着走路并且一整天都这样移动",
            "用不同水果的果皮制作一件可穿戴的艺术品",
            "给家里的宠物举办一场正式的婚礼仪式",
            "用影子表演一出完整的皮影戏",
            "尝试用脚完成所有日常任务一整天",
            "用树叶和花朵制作自己的香水",
            "在浴室里开一场个人演唱会并录制下来",
            "用蔬菜雕刻出十二生肖的所有动物",
            "学会用手语唱一首流行歌曲",
            "请男性穿上洛丽塔，女性可无视本次指令"
        ];

        const instructionText = document.getElementById('instructionText');
        const footerText = document.getElementById('footerText');
        const audioStatus = document.getElementById('audioStatus');

        // 存储键名
        const STORAGE_KEYS = {
            LAST_CLICK_DATE: 'herald_last_click_date',
            LAST_INSTRUCTION: 'herald_last_instruction'
        };

        // 音频对象
        let welcomeAudio = null;
        let typingAudio = null;
        let isTypingAudioPlaying = false;

        // 初始化音频
        function initAudio() {
            try {
                welcomeAudio = new Audio('yin/1.wav');
                welcomeAudio.preload = 'auto';
                typingAudio = new Audio('yin/2.wav');
                typingAudio.preload = 'auto';
                audioStatus.textContent = '音频: 已加载';
                setTimeout(() => {
                    playWelcomeAudio();
                }, 500);
            } catch (error) {
                console.error('音频初始化失败:', error);
                audioStatus.textContent = '音频: 加载失败';
            }
        }

        function playWelcomeAudio() {
            if (welcomeAudio) {
                welcomeAudio.play().then(() => {
                    audioStatus.textContent = '';
                    setTimeout(() => {
                        audioStatus.textContent = '';
                    }, 1000);
                }).catch(error => {
                    console.error('播放欢迎音频失败:', error);
                    audioStatus.textContent = '';
                });
            }
        }

        function playTypingAudio() {
            if (typingAudio && !isTypingAudioPlaying) {
                isTypingAudioPlaying = true;
                typingAudio.currentTime = 0;
                typingAudio.play().then(() => {
                    audioStatus.textContent = '音频: 打字音效';
                    setTimeout(() => {
                        typingAudio.pause();
                        typingAudio.currentTime = 0;
                        isTypingAudioPlaying = false;
                        audioStatus.textContent = '音频: 就绪';
                    }, 3000);
                }).catch(error => {
                    console.error('播放打字音频失败:', error);
                    isTypingAudioPlaying = false;
                    audioStatus.textContent = '音频: 播放失败';
                });
            }
        }

        // 获取今天日期字符串（YYYY-MM-DD格式）
        function getTodayDateString() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }

        // 检查是否可以点击（每天只能点击一次）
        function canClickToday() {
            const lastClickDate = localStorage.getItem(STORAGE_KEYS.LAST_CLICK_DATE);
            const today = getTodayDateString();
            return lastClickDate !== today;
        }

        // 记录今天的点击
        function recordTodayClick(instruction) {
            const today = getTodayDateString();
            localStorage.setItem(STORAGE_KEYS.LAST_CLICK_DATE, today);
            localStorage.setItem(STORAGE_KEYS.LAST_INSTRUCTION, instruction);
        }

        // 检查并恢复今天的指令（如果有）
        function checkAndRestoreTodayInstruction() {
            const lastClickDate = localStorage.getItem(STORAGE_KEYS.LAST_CLICK_DATE);
            const lastInstruction = localStorage.getItem(STORAGE_KEYS.LAST_INSTRUCTION);
            const today = getTodayDateString();

            // 关键逻辑：如果上次点击是今天，则返回保存的指令
            if (lastClickDate === today && lastInstruction) {
                return lastInstruction;
            }
            
            return null;
        }

        // 显示限制提示
        function showLimitHint() {
            const oldHint = instructionText.querySelector('.limit-hint');
            if (oldHint) oldHint.remove();

            const limitHint = document.createElement('div');
            limitHint.classList.add('limit-hint');
            limitHint.textContent = '今日指令已生成，请明天再来';
            instructionText.appendChild(limitHint);
        }

        // 预加载自定义字体
        function preloadFont() {
            const font = new FontFace('FashionBitmap', 'url(ziti/FashionBitmap16_0.092.ttf)');
            font.load().then(function(loadedFont) {
                document.fonts.add(loadedFont);
                console.log('字体加载成功');
                showInitialText();
            }).catch(function(error) {
                console.log('字体加载失败:', error);
                document.body.style.fontFamily = "'Courier New', monospace";
                document.querySelectorAll('.instruction-title, .instruction-text, .footer').forEach(el => {
                    el.style.fontFamily = "'Courier New', monospace";
                });
                showInitialText();
            });
        }

        // 显示初始文字
        function showInitialText() {
            // 首先检查是否有今天已经生成的指令
            const todayInstruction = checkAndRestoreTodayInstruction();
            
            console.log('检查今天指令:', {
                todayDate: getTodayDateString(),
                lastClickDate: localStorage.getItem(STORAGE_KEYS.LAST_CLICK_DATE),
                lastInstruction: localStorage.getItem(STORAGE_KEYS.LAST_INSTRUCTION),
                foundInstruction: todayInstruction
            });
            
            if (todayInstruction) {
                // 显示今天的指令
                console.log('显示今天已生成的指令:', todayInstruction);
                typeWriter(todayInstruction, instructionText, 60, false);
                showLimitHint();
            } else {
                // 显示默认提示
                console.log('显示初始提示，可以点击生成新指令');
                typeWriter("点击文字生成今日指令", instructionText, 60, false);
            }
        }

        // 文字逐个显示函数
        function typeWriter(text, element, speed = 50, playSound = true) {
            element.innerHTML = '';

            if (playSound) {
                playTypingAudio();
            }

            const chars = text.split('');
            let charIndex = 0;

            function typeNextChar() {
                if (charIndex < chars.length) {
                    const span = document.createElement('span');
                    span.classList.add('char');
                    span.textContent = chars[charIndex] === ' ' ? '\u00A0' : chars[charIndex];
                    element.appendChild(span);
                    span.style.animationDelay = `${charIndex * speed}ms`;
                    charIndex++;
                    setTimeout(typeNextChar, speed);
                } else {
                    // 检查是否需要添加限制提示
                    if (!canClickToday()) {
                        showLimitHint();
                    } else {
                        const clickHint = document.createElement('div');
                        clickHint.classList.add('click-hint');
                        clickHint.textContent = '点击生成今日指令';
                        element.appendChild(clickHint);
                    }
                }
            }

            typeNextChar();
        }

        // 生成随机指令
        function generateRandomInstruction() {
            // 检查是否可以点击
            if (!canClickToday()) {
                console.log('今天已点击过，不能再生成新指令');
                instructionText.style.animation = 'click-pulse 0.8s ease';
                setTimeout(() => {
                    instructionText.style.animation = '';
                }, 800);
                return;
            }

            // 随机选择一条指令
            const randomIndex = Math.floor(Math.random() * instructions.length);
            const randomInstruction = instructions[randomIndex];
            
            console.log('生成新指令:', randomInstruction);

            // 记录今天的点击
            recordTodayClick(randomInstruction);

            // 显示指令
            typeWriter(randomInstruction, instructionText, 40, true);

            instructionText.style.animation = 'click-pulse 0.8s ease';
            setTimeout(() => {
                instructionText.style.animation = '';
            }, 800);
        }

        // 添加点击事件监听器
        function addClickListeners() {
            instructionText.addEventListener('click', generateRandomInstruction);
            footerText.addEventListener('click', generateRandomInstruction);
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成，开始初始化...');
            initAudio();
            preloadFont();
            addClickListeners();
            
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space' || event.code === 'Enter') {
                    generateRandomInstruction();
                }
            });
        });
    </script>
</body>
</html>